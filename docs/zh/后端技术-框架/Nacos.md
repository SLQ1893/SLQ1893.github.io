## 1、Nacos 是什么技术？

Nacos 是"**Dynamic Naming and Configuration Service**"的首字母简称，是阿里开源的一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。

Nacos 是构建以“**服务**”为中心的现代应用架构的服务基础设施，支持几乎所有主流类型的“服务”的发现、配置和管理；

- rnates Service
- gRPC & Dubbo RPC Service
- Spring Cloud RESTful Service

使用 Nacos 简化服务发现、配置管理、服务治理及管理的解决方案，让微服务的发现、管理、共享、组合更加容易。

下载地址：

> https://github.com/alibaba/nacos/releases

## 2、为什么要用 Nacos？有什么优势？

Nacos 的优势：

##### （1）易用性

数据模型简单，标准的 Restful API，易用的控制台，丰富的使用文档。

##### （2）稳定性

具备企业级 SLA 的开源产品，高可用必达 99.9%，历经阿里巴巴 10 年生产验证的内部产品。

##### （3）实时性

数据变更毫秒级推送生效。

##### （4）规模

支持具有数百万服务的大规模场景，十万级服务/配置，百万级连接，具备强大扩展性。

## 3、Nacos 和 Eureka 有什么区别？

下面是特性对比：

| 特性             | Nacos                    | Eureka                   |
| ---------------- | ------------------------ | ------------------------ |
| 注册中心         | 支持                     | 支持                     |
| 配置中心         | 支持                     | 不支持                   |
| 服务发现单机 TPS | 30680.48                 | 6431                     |
| 服务注册单机 TPS | 26784.84                 | 4793                     |
| 架构             | AP/CP                    | AP                       |
| 水平扩展         | 存算合一，不支持水平扩展 | 存算合一，不支持水平扩展 |
| 健康检查         | 主动探测+客户端心跳/连接 | 客户端心跳               |
| 推空保护         | 支持                     | 支持                     |
| 可定制           | 插件化                   | 插件化                   |
| 负载均衡         | 支持                     | 不支持                   |
| 跨地域容灾       | 不支持                   | 不支持                   |

## 4、Nacos 可替换 Spring Cloud 体系中的哪个组件？

Nacos 作为服务注册中心，可替换 Spring Cloud Eureka 组件，因为 Eureka 2.0 已经不维护了，现在 Nacos 成为主流注册组件。

Nacos 作为服务配置中心，还可替换 Spring Cloud Config 配置中心。

## 5、Nacos 有哪些核心功能？

Nacos 的核心功能如下：

- 服务发现和服务健康监测；
- 动态配置服务；
- 动态 DNS 服务；
- 服务及其元数据管理；
- ....

更多可以看下面的 Nacos 详细地图：

![](/images/Nacos/5.jpg)

## 6、Nacos 的基本架构是怎样的？

Nacos 架构图如下：

![](/images/Nacos/6.jpg)

##### 服务（Service）

服务是指一个或一组软件功能（例如特定信息的检索或一组操作的执行），其目的是不同的客户端可以为不同的目的重用（例如通过跨进程的网络调用）。

##### 服务注册中心（Service Registry）

服务注册中心，它是服务，其实例及元数据的数据库。服务实例在启动时注册到服务注册表，并在关闭时注销。服务和路由器的客户端查询服务注册表以查找服务的可用实例。服务注册中心可能会调用服务实例的健康检查 API 来验证它是否能够处理请求。

##### 服务元数据（Service Metadata）

服务元数据是指包括服务端点(endpoints)、服务标签、服务版本号、服务实例权重、路由规则、安全策略等描述服务的数据。

##### 服务提供方（ServiceProvider）

是指提供可复用和可调用服务的应用方。

##### 服务消费方（Service Consumer）

是指会发起对某个服务调用的应用方。

##### 配置（Configuration）

在系统开发过程中通常会将一些需要变更的参数、变量等从代码中分离出来独立管理，以独立的配置文件的形式存在。目的是让静态的系统工件或者交付物（如 WAR，JAR 包等）更好地和实际的物理运行环境进行适配。配置管理一般包含在系统部署的过程中，由系统管理员或者运维人员完成这个步骤。配置变更是调整系统运行时的行为的有效手段之一。

##### 配置管理（Configuration Management）

在数据中心中，系统中所有配置的编辑、存储、分发、变更管理、历史版本管理、变更审计等所有与配置相关的活动统称为配置管理。

##### 名字服务（NamingService）

提供分布式系统中所有对象(Object)、实体(Entity)的"名字"到关联的元数据之间的映射管理服务，例如 ServiceName->Endpoints Info,Distributed LockName -> Lock Owner/Status Info, DNS Domain Name -> IP List, 服务发现和 DNS 就是名字服务的 2 大场景。

##### 配置服务（ConfigurationService）

在服务或者应用运行过程中，提供动态配置或者元数据以及配置管理的服务提供者。

## 7、Nacos 支持哪些编程语言？

Nacos 几乎支持市面上所有主流的编程语言，比如：**Java、GO、Python、C#、C++**等。

![](/images/Nacos/7.jpg)

其中**Java/Golang/Python 已经支持 Nacos 2.0 长链接协议**，能最大程度发挥 Nacos 的性能。

## 8、Nacos 支持的 JDK 最低版本？

Nacos 仅支持 JDK 1.8+

## 9、Nacos 是否可用于生产环境？

可以的，Nacos 在 2019.1 发布的 Pre-GA 版本，支持了安全隔离、监控和服务迁移等上生产的最后一公里，以更稳定的支撑用户的生产环境。

## 10、Nacos 需要用到数据库吗？

Nacos 单机模式默认使用**内嵌的数据库（Derby）**作为存储引擎，也可以使用独立的 **MySQL** 数据库（仅支持 MySQL）。

> Nacos 虽然默认内置 Derby 数据库，这是一种简便的启动方式，它特别适用于快速测试和轻量级部署，但生产环境建议采用外部数据库（MySQL），以确保系统的高可用性和数据一致性

使用独立数据库需要修改**conf/application.properties**配置文件：

```properties
spring.datasource.platform=mysql
db.num=1
db.url.0=jdbc:mysql://11.162.196.16:3306/test?characterEncoding=utfs&connectTimeout=1eeo&socketTimeout=3000&autoReconnect=true
db.user=test
db.password=123456
```

然后还需要执行**conf/mysql-schema.sql** 初始化文件。

## 11、Nacos 默认端口是？怎么修改？

默认端口为：8848，可以修改配置文件：

> /conf/application.properties

我们修改为：7001

```properties
server.port=7001
```

## 12、Nacos 性能如何？

##### 服务发现（Nacos 2.0）：

1、服务及实例容量达到百万级，集群运行持续稳定。

2、注册/注销实例 TPS 达到 26000 以上，总体较 Nacos 1.X 提升至少 2 倍。

3、查询实例 TPS 能够达到 30000 以上，总体较 Nacos 1.X 提升 3 倍左右。

##### 配置管理（Nacos2.0）：

- Nacos 2.0 读 QPS 14000 QPS， 对比比 Nacos 1.X QPS 8000 提升 75%。
- Nacos 2.0 写 TPS 2500 TPS，对比 Nacos 1.X 无明显提升。
- Nacos 2.0 支撑长链接 400oo 以上，对比 Nacos 1.X 提升 7 倍以上。
- Nacos 2.0 变更推送 1500/s,对比 Nacos 1.X 无明显提升。

> 以上来源于 Nacos 官方数据，仅提供给大家参考，可能偏差。

## 13、Nacos 数据模型是怎样的？

Nacos 数据模型由下面三个元素组成：

- Namespace：命名空间，默认是空串，公共命名空间是 public。
- Group：分组，分组默认是 DEFAULT_GROUP。
- Service/Datald：服务名/数据 ID。

![](/images/Nacos/13.jpg)

一般推荐使用由**运行环境作为命名空间、应用名作为分组和服务功能作为服务名**的组合来确保该服务的唯一性。

## 14、Nacos 是如何支持多环境的？

在日常使用中常常需要不同的环境，比如开发，测试，预生产，生产环境等等。

- 如果是**逻辑隔离**可以使用命名空间，Nacos 支持命名空间来支持多环境隔离，可以在 Nacos 控制台创建多个命名空间。
- 如果需要**物理隔离**，就要部署多套 Nacos 环境。

## 15、Nacos 命名空间是什么？说说应用场景？

Nacos 中的命名空间（Namespace）用于进行租户粒度的配置隔离，不同的命名空间下，可以存在相同的 Group 或 Data ID 的配置。

常用场景之一是，不同环境的配置的区分隔离，例如开发测试环境和生产环境的资源（如配置、服务）隔离等。

## 16、Nacos 临时实例和持久实例的区别？

##### 临时实例

临时存储于注册中心，临时实例自动发送心跳上报健康状态，发送心跳的周期默认是 5 秒，Nacos 服务端在 15 秒没收到心跳后将实例设置为不健康，在 30 秒没收到心跳时将这个临时实例摘除。

##### 持久实例

永久存储于注册中心，Nacos 服务端使用反向探测的方式进行健康检查，除非调用接口主动注销，否则服务端无法摘除不健康实例。

## 17、Nacos 实例为什么要设计临时和持久两种类型？

对于临时实例，如果健康检查失败，则直接从注册中心直接删除。所以，临时实例就比较适合用来应对流量突增的场景，服务实例需要动态弹性扩容，当突增流量过后，把扩容新增的服务实例停掉，就能可以从注册中心快速移除了。

对于持久化实例，如果健康检查失败，会被标记成不健康状态，但是不会主动删除，但是可以方便运维人员看到实例的实时健康状态，比如可以设置警告、扩容等一些列提前预防措施。

## 18、Nacos 实例默认是临时类型，还是持久类型？

Nacos 实例默认是临时类型，这个可以从 Nacos 实例配置参数类 NacosDiscoveryProperties 和实例类 Instance 源码中看到：

![](/images/Nacos/18_1.jpg)

![](/images/Nacos/18_2.jpg)

ephemeral = true 则表示实例默认是临时的，实例启动后，从 Nacos 控制台也可以看到：

![](/images/Nacos/18_3.jpg)

可以通过参数设置是否临时/持久实例：

```yaml
spring:
  cloud:
    nacos:
      discovery:
        ephemeral: false
```

false 表示非临时实例，即持久实例。

## 19、Nacos 服务注册发现流程是怎样的？

##### Nacos 服务注册发现流程图如下：

![](/images/Nacos/19.jpg)

提供者服务向注册中心注册，如果是临时实例，实例会定时向注册中心发送心跳以维护活动，如果是持久实例，注册中心会通过 API 主动检测提供者健康状态。

消费者服务向注册中心订阅并获取提供者服务地址列表，并每隔一段时间（默认：10s）就重新拉取一次服务实例列表并缓存到本地，如果提供者服务状态有变更，注册中心也会推送通知给消费者。

消费者根据负载均衡算法选择一个实例进行调用。

## 20、Nacos 是如何防止读写并发冲突的？和 Eureka 处理有什么区别？

Nacos 更新注册表时，为了防止读写并发冲突，大量的运用了 CopyOnWrite 思想，即先把原内存注册表的数据拷贝一份再进入写入操作，操作完之后，再最后替换内存中真正的注册表。

Eureka 防止读写并发冲突用的方法是注册表的多级缓存结构，如：只读缓存，读写缓存，内存注册表，各级缓存之间定时同步，所以在客户端感知方面不如 Nacos。

## 21、Nacos 服务怎么优雅下线？

可以在 Nacos 服务列表详请中点击下线按钮：

![](/images/Nacos/21.jpg)

## 22、Nacos 配置中心的数据格式是怎样的？

在 Nacos Spring Cloud 中，datald 的完整格式如下：

> ${prefix}-${spring.profiles.active}.${file-extension}

格式说明：

| 参数                   | 说明                                                                                                      |
| ---------------------- | --------------------------------------------------------------------------------------------------------- |
| prefix                 | 默认为 spring.application.name 的值，可以通过 spring.cloud.nacos.config.prefix 参数来配置                 |
| spring.profiles.active | 当前环境对应的 profile，如果此值为空，对应的连接符－也将不存在，datald 的拼接格式变成{file-extension}     |
| file-exetension        | 配置格式，目前只支持 properties 和 yml 类型，可以通过 spring.cloud.nacos.config.file-extension 参数来配置 |

使用 Nacos 配置，就必须了解了这些配置规则。

> 比如：order-dev.yml，代表 order 应用的开发环境配置。

## 23、Nacos 支持多应用配置吗？

可以的，比如下图示例：

![](/images/Nacos/23.jpg)

## 24、Nacos 支持多个应用共享同一份配置吗？

支持的，Nacos 支持配置共享功能。

## 25、Nacos 支持配置加密和解密吗？

##### 支持，不过老版本暂时不兼容，目前支持版本 2.0.4+

## 26、Nacos 配置加密和解密的实现原理是？

Nacos 是通过 SPI 的机制抽象出加密和解密的操作，Nacos 默认提供 AES 的实现，也可以自定义加解密的实现方式。

![](/images/Nacos/26.jpg)

在 Nacos 服务端启动的时候就会加载所有依赖的加解密算法，然后通过发布配置的 datald 的前缀来进行匹配是否需要加解密和使用的加解密算法。

客户端发布的配置会在客户端通过 flter 完成加解密，也就是配置在传输过程中都是密文的，而控制台发布的配置会在服务端进行处理。

## 27、Nacos 配置变更如何通知第三方系统？

在 Nacos 2.3.0 之前的版本中，Nacos 只能通过模拟客户端订阅配置的方式实现，这种方式存在许多的局限性。所以，Nacos 2.3.0 正式推出了 Nacos 配置变更插件。

Config Change Plugin，即配置变更插件，可用于 Nacos 配置中心能在配置发生变更时，通知一些特定系统，比如，可用于发送配置变更记录、变更提醒及警告、审计等功能等。

该插件也支持通过 SPI 的方式注入配置，也支持用户自定义配置变更插件，**可以对配置变更前，和变更完成后分别执行一些自定义逻辑**，如格式校验，白名单校验，webhook 通知等，相比之前的方式要更强大、更灵活。

## 28、Nacos 动态刷新的实现原理是？

##### Nacos 1.x

---

在 Nacos 1.x 版本中，动态刷新是通过轮询的方式实现的，采用的是 HTTP 1.1 来模拟长连接，应用程序默认每 10s 发一次心跳到服务器，服务器对比配置的 MD5 值是否一致：

- 如果有不一致的配置，就把不一致的 datald 返回；
- 如果一致就保持连接 30 秒，在此期间，如果有配置变更，则把对应的 datald 返回。

如果应用程序收到变更的 datald，则根据 datald 去服务器获取最新配置值并更新本地缓存。

##### Nacos 2.x

---

在 Nacos 2.x 版本中，引 I 入了基于长连接的推送机制，即应用程序会与 Nacos 服务器建立长连接，一旦配置数据有变化，Nacos 服务器就会主动推送变更配置列表给应用程序，然后应用程序拉取最新配置更新，从而实现动态刷新的效果。

相比于轮询的方式，基于长连接的推送机制能够更快速地获取最新的配置数据，减少了网络请求的开销，提高了配置更新的效率。

## 29、Nacos 鉴权插件是什么？

Nacos 2.1.0+版本开始，支持通过 SPI 的方式注入鉴权相关插件，并在 application.properties 配置文件中选择某一种插件实现作为实际鉴权服务。

鉴权，即验证 **谁** 是否能够对 **某个东西** 进行**某种操作**，因此 Nacos 在设计鉴权插件时，将鉴权信息主要抽象为身份信息，资源和操作类型 3 类主要概念。

比如，服务端启用鉴权之后，需要用户名和密码登录之后才能正常使用 Nacos。

## 30、Nacos 认证机制使用的什么安全框架？

Nacos 是一个基于 Spring Boot 开发的项目，内部使用了 Spring Security 作为权限认证框架。

## 31、Nacos 配置管理客户端和服务端通信机制是怎样的？

##### Nacos 1.X

Nacos 1.X 使用的是 HTTP 1.1 短链接来模拟长链接，每 30s 发一个心跳跟 Server 端，对比客户端配置 MD5 值是否跟 Server 保持一致，如果一致就继续保持住链接，否则就把不一致的配置返回，然后客户端再获取最新配置值。Nacos 2.X

##### Nacos 2.X

升级为长连接模式，如果配置变更则建立长链接，服务端再向客户端推送变更配置列表，然后客户端再主动拉取配置更新，此种方式大幅提升了通信效率。

## 32、Nacos 服务包括哪些基本信息？

服务包括以下几个基本信息：

- 命名空间（Namespace）
- 分组（Group）
- 服务名（Name）

## 33、Nacos 服务元数据是什么？包含哪些信息？

服务只包括服务基本信息，**服务元数据**进一步定义了 Nacos 中服务的细节属性和描述信息，主要包含以下信息：

- **健康保护阈值（ProtectThreshold）**：为防止因过多实例故障，导致过多流量流入剩余实例设置的阈值。
- **实例选择器**：用于在获取服务下的实例列表时，过滤和筛选实例。
- **拓展数据（extendData）**：用户在注册实例时自定义扩展的元数据内容。

## 34、Nacos 服务实例包括哪些基本信息？

服务实例是提供服务的具体节点，主要存储该实例的一些网络相关的基础信息：

- **网络 IP 地址**：实例 IP 地址，Nacos 2.x 可以为域名。
- **网络端口**：该实例的端口信息。
- **健康状态（Healthy）**：实例健康状态。
- **集群（Cluster）**：实例归属的逻辑集群标识。
- **拓展数据（extendData）**：用户自定义扩展的元数据内容。

## 35、Nacos 实例元数据是什么？包含哪些信息？

和服务元数据不同，实例元数据主要用于实例运维相关的数据信息，主要包含以下信息：

- **权重（Weight）**：权重为浮点数，范围为 0-10000，权重越大，实例分配的流量越大。
- **上线状态（Enabled）**：标记该实例是否接受流量，可快速将某个实例从服务中移除。
- **拓展数据（extendData）**：在不变动实例本身的情况下，可快速地修改和新增实例的扩展数据。

## 36、Nacos 健康检查机制是怎样的？

Nacos 既支持客户端的主动心跳上报健康检查，也支持服务端的探测健康检查，具体得根据不同的实例类型，请前往面试题：Nacos 临时实例和持久实例的区别？

同一个服务可以切换不同的健康检查模式。

## 37、Nacos 健康检查的作用是什么？

Nacos 健康检查以指定方式检查服务下注册的实例的健康度，从而确认该实例是否能提供服务。根据检查结果，实例会被判断为健康或不健康，在对服务发起解析请求时，不健康的实例不会返回给客户端。

## 38、Nacos 健康保护阀值的作用是什么？

Nacos 为了防止因过多实例不健康导致流量全部流向健康实例，继而造成流量压力把健康实例压垮并形成雪崩效应，应将健康保护阈值定义为一个 0 到 1 之间的浮点数。

当域名健康实例数占总服务实例数的比例小于该值时，无论实例是否健康，都会将这个实例返回给客户端，这样做虽然损失了一部分流量，但是保证了集群中剩余健康实例能正常工作。

## 39、Nacos 内部负载均衡的作用？

因为阿里巴巴内部服务访问流量巨大，防止流量异常压垮服务提供者的服务，所以服务提供者需要能够完全掌控服务的流量调配，并可以动态调整，这就是负载均衡的目的。

Nacos 提供了基于健康检查、权重、以及基于第三方 CMDB 的标签负载均衡器。

## 40、Nacos 如何实现服务的就近访问？

当服务部署在多个地域时，使用**标签负载均衡器**可以实现同标签优先访问的流量调度策略，即可以用来实现服务的就近访问，标签负载均衡器可以支持其他更多的场景。

## 41、Nacos 为什么需要一致性协议？

我们都知道，Nacos 组件内部需要用到数据存储，单机环境下使用简单的**内嵌关系型数据库**即可搞定，但是在集群模式下，就需要考虑各个节点之间的数据一致性以及数据同步性问题，而要解决这个问题，就必须引入一致性协议来保证各个节点之间的数据的一致性。

## 42、Nacos 使用了什么一致性协议？

##### Nacos 选择了 Raft（JRaft）以及 Distro 协议。

1）Raft 协议是使用最多的强一致性共识算法，选择 JRaft，是因为 JRaft 支持多 RafGroup，能支持 Nacos 多数据分片。

2）Distro 协议是阿里巴巴自研的最终一致性协议，集成了 Gossip 以及 Eureka 协议的优点并加以优化。

## 43、Nacos 服务注册是怎么选择一致性协议的？

从服务注册来看：

**如果是非持久化服务**，即需要客户端主动发送心跳续约的场景，这种情况，如果是数据丢失，是可以通过客户端心跳补偿的，所以强一致性共识算法在这里不合适了，否则如果没有过半节点存活就会导致整个集群罢工，所以这是选择了最终一致性算法。

**如果是持久化服务**，即通过 Nacos Server 创建的服务，这时则需要 Nacos 来确保所有节点的数据一致性，所以这里最终一致算法就不合适了，必须选择强一致性共识算法。

## 44、Nacos 配置管理是怎么选择一致性协议的？

##### 配置管理使用的是强一致性算法（Raft）。

因为配置数据都是在 Nacos 服务端进行创建和管理的，必须在所有节点完成同步的情况下才认为是保存成功了，所以必须保证集群中大部分的节点是强一致的。

## 45、Nacos 中的 Distro 协议？

Distro 协议是 Nacos 社区自研的一种 AP 分布式协议，是面向临时实例设计的一种分布式一致性协议，集成了 Gossip 以及 Eureka 协议的优点并加以优化,其数据存储在缓存中，并且会在启动时进行全量数据同步，并定期进行数据校验。

## 46、Nacos 支持哪几种部署模式？

Nacos 支持三种部署模式：

- **单机模式**：用于测试和单机试用。

- **集群模式**：用于生产环境，确保高可用。

- **多集群模式**：用于多数据中心场景。

## 47、Nacos 部署都有什么依赖？

Nacos 在单机模式下部署没有任何依赖，在集群模式下需要依赖 MySQL 做存储。

## 48、Nacos 支持 Docker 部署吗？

支持的，除了使用压缩包部署 Nacos，Nacos 也提供了相应的 Docker 镜像，当 Nacos 发布新的版本的时候，Nacos 会发布对应的镜像版本支持 Docker 部署。

Docker 镜像地址：

> https://github.com/nacos-group/nacos-docker

## 49、Nacos 支持 k8s 部署吗？

支持的，为了能进行自动化运维，Nacos 和 k8s 结合，利用 StatefuISets 提供了自动运维方案，能对 Nacos 进行动态扩缩容。

## 50、Nacos 可以迁移 Zookeeper 上的服务吗？

可以的，可以通过 Nacos-Sync 把 Zookeeper 服务迁移到 Nacos，也可以从 Nacos 迁移到 Zookeeper。

> NacosSync 是一个支持多种注册中心的同步组件，基于 Spring Boot 开发框架，数据层采用 Spring Data JPA，支持多种数据源存储，默认使用的是 Hibermate 实现，支持表的自动创建更新。

具体可以参考示例：

> https://github.com/paderlol/nacos-sync-example

## 51、Nacos 支持 Dubbo 吗？

Nacos 0.6+ 以上版本才支持和 Dubbo 集成。

## 52、Nacos 集群如何扩缩容？

Nacos 目前支持修改 **cluster.conf** 文件的方式进行扩缩容，改完后无需重启，Nacos Server 会自动刷新到文件新内容。

## 53、Nacos 集群是 CP 还是 AP？

Nacos 集群同时支持 AP 和 CP，如果注册的节点是临时节点，那么就是 AP，如果是持久节点，那么就是 CP，默认是临时节点 AP。

Eureka 是 AP，CAP 概念及相关面试题请前往**分布式**分类。

## 54、Nacos 为什么需要寻址机制？

Nacos 集群中的所有节点需要能相互通信，要能感知成员节点的变更，节点是增加了，还是减少了，以及怎样去管理成员节点等等，这就是 Nacos 内部的寻址机制。

## 55、Nacos 支持哪几种寻址机制？

Nacos 支持以下 3 种寻址方式：

1）单机寻址

2）文件寻址 (集群模式默认)

3）地址服务器寻址

## 56、Nacos 如何监控？支持哪些监控系统？

Nacos 0.8.0+支持监控，支持通过暴露 **Metrics** 数据接入第三方监控系统监控 Nacos 运行状态，目前支持以下监控系统：

- prometheus
- elastic search
- influxdb

## 57、Nacos 如何防止资源访问过多，从而导致服务端大规模故障？

可以使用 Nacos 中的反脆弱插件，Nacos 2.2.0 版本开始加入反脆弱插件，从 2.3.0 版本开始正式转正可用。

Nacos Control Plugin，即反脆弱插件，即防止服务端变得脆弱，它的主要用途是保护 Nacos 服务端避免出现大规模故障，就算在高压情况下也能快速拒绝请求，防止过多的资源访问导致服务端资源耗尽引起的大面积不可用。

> ##### 反脆弱插件的具体实现策略：
>
> 当访问服务端的某种资源的频率或次数达到一定程度时，则限制其访问。

Nacos 支持通过 SPI 的方式注入反脆弱相关插件，并支持在`application·properties` 配置文件中配置一个反脆弱插件的实现，SPI 机制的灵活性可以大大增加了反脆弱插件的扩展灵活性，这个机制也贯穿了阿里系开源框架。

## 58、Nacos 控制台是什么？

Nacos 控制台提供了服务列表，健康状态管理，服务治理，分布式配置管理等方面的管控能力，主要包括下列基本功能：

- 服务管理
  - 服务列表及服务健康状态展示
  - 服务元数据存储及编辑
  - 服务流量权重的调整
  - 服务优雅上下线
- 配置管理
  - 多种配置格式编辑
  - 编辑 DIFF
  - 示例代码
  - 推送状态查询
  - 配置版本及一键回滚
- 命名空间
- 登录管理

## 59、Nacos 控制台支持登录功能吗？

Nacos0.8+支持简单登录功能，默认用户名密码为：nacos/nacos。

![](/images/Nacos/59.jpg)

## 60、Nacos 控制台使用的什么前端框架？

Nacos 前端框架使用的是目前比较流行的 React 前端框架，因为 React 的 PC 组件库生态更成熟强大，前端组件则选择的是 Fusion。

## 61、Nacos 如何实现操作记录轨迹追踪？

Nacos 中的轨迹追踪不同于微服务中的调用链路追踪，Nacos 轨迹追踪的主要目的是追踪和记录一些 Nacos 的相关操作，如：**服务注册、注销、推送、状态变更等**。

Nacos 2.2.0+开始支持**轨迹追踪**功能，Nacos 在关键操作的链路中进行了埋点，定义了一系列的`TraceEvent`追踪事件，将多个针对相同资源（如服务，配置等）的追踪事件串起来之后，便可以得到该资源的轨迹。

在追踪事件`TraceEvent`中会包含如下内容：

| 字段名      | 描述                                          |
| ----------- | --------------------------------------------- |
| type        | 事件的类型，由具体事件定义                    |
| eventTime   | 事件发生的时间                                |
| namespaceld | 事件对应资源的命名空间 ID                     |
| group       | 事件对应资源的分组名                          |
| name        | 事件对应资源的资源名，如服务名或配置的 datald |

Nacos 现在可通过 SPI 机制注入轨迹追踪实现插件，在插件中订阅并处理追踪事件，并按照你指定的方式进行处理，如：记录日志，写入存储等。

## 62、Nacos 支持 HTTPS 登录控制吗？

Nacos 默认不支持 https，如果有需要，则需要在 Nginx 端配置，把 443 端口映射到 Nacos 的 8848 端口，然后在 Nginx 上管理证书。

## 63、Nacos 可以暴露在公网上吗？

不建议暴露在公网，因为 Nacos 是一个内部微服务组件，需要在可信的内部网络中运行，暴露在公网环境会带来安全风险。

虽然 Nacos 提供简单的鉴权实现，只是为了防止业务错用的弱鉴权体系，而不是防止恶意攻击的强鉴权体系。如果需要暴露公网，请参考官方简单实现做替换增强。

## 64、Nacos 2.0 通信方式有什么变化？

Nacos 2.0 版本相比 1.X 新增了**gRPC** 的通信方式，因此需要增加 2 个端口：

| 端口 | 与主端口的偏移量 | 描述                                                         |
| ---- | ---------------- | ------------------------------------------------------------ |
| 9848 | 1000             | 客户端 gRPC 请求服务端端口，用于客户端向服务端发起连接和请求 |
| 9849 | 1001             | 服务端 gRPC 请求服务端端口，用于服务间同步等                 |

新增端口是在配置的主端口（server.port）基础上，进行一定偏移量自动生成。

##### 使用 VIP/nginx 请求时，需要配置成 TCP 转发，不能配置 http2 转发，否则连接会被 nginx 断开。

![](/images/Nacos/64.jpg)

客户端拥有相同的计算逻辑，用户如同 1X 的使用方式，配置主端口（默认 8848），通过相同的偏移量，计算对应的 gRPC 端口（默认 9848）。因此如果客户端和服务端之前存在端口转发，或防火墙时，需要对端口转发配置和防火墙配置做相应的调整。

## 65、Nacos 2.x 客户端和服务端能兼容 1.x 吗？

Nacos 2.0 服务端完全兼容 1.x 客户端，而由于 Nacos 2.0 客户端使用了 gRPC 框架，所以无法兼容 Nacos 1.x 服务端。

> Nacos 1.x 客户端一 YES 一 Nacos 1.x 服务端
>
> Nacos 2.x 客户端一 NO — Nacos 1.x 服务端
>
> Nacos 1.x 客户端一 YES 一 Nacos 2.x 服务端
>
> Nacos 2.x 客户端一 YES － Nacos 2.x 服务端

## 66、Nacos 是如何解决多版本之间功能兼容性问题的？

我们都知道，Nacos 分为服务端和客户端，随着 Nacos 版本越来越高，功能越来越多，不同版本间对新增功能支持程度也会很大的差异。

当版本和功能越来越多的时候，如果版本不一致，两者的通信可能存储一定的兼容性问题。比如，服务端有这个功能，而客户端的版本不支持，这样就会产生兼容性问题，也会带来多余和通信开销。

在 Nacos 2.3.0 之前的版本中，Nacos 中的很多能力都是根据版本号来判断的，可读性、可维护性和可扩展性都很差。**所以，Nacos 2.3.0 新增了一个客户端和服务端之间的能力协商机制。**

这个机制的工作原理是：

- **版本协商**：当客户端与服务端进行通信时，会先进行版本协商，客户端和服务端会首先交换各自支持的功能列表。
- **功能匹配**：在了解了对方支持的功能后，客户端和服务端将根据双方都支持的功能集进行通信。这样，即使是不同版本的客户端和服务端，也能确保在共同支持的功能范围内正常交互，避免了因版本不一致带来的问题。
- **优化通信**：通过这种机制，Nacos 可以在不同版本的客户端和服务端之间优化通信效率，减少不必要的兼容性问题，确保系统的稳定性和效率。

总的来说，这个能力协商机制，可以让连接的双方都知道对方能支持的所有功能，以便双方都开启对应的功能并进行相应的操作，避免盲目的试错带来的系统性问题及额外开销。
